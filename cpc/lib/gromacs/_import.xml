<?xml version="1.0"?>
<cpc>
    <desc>Gromacs specific functions</desc>
    <type id="grompp-include-array" base="array" member-type="file" />

    <!-- individual settings -->
    <type id="setting" base="list">
        <field id="name" type="string" />
        <field id="value" type="string" />
        <desc>An individual grompp mdp setting</desc>
    </type>
    <type id="mdp-array" base="array" member-type="setting">
        <desc>An array of grompp mdp settings</desc>
    </type>

    <!-- gromacs mdrun controller function -->
    <function id="grompp" type="python-extended">
        <desc>The gromacs pre-processor: prepares run files for mdrun</desc>
        <inputs>
            <field type="file" id="conf">
                <desc>A .gro configuration file</desc>
            </field>
            <field type="file" id="mdp" >
                <desc>A .mpp settings file</desc>
            </field>
            <field type="file" id="top" >
                <desc>A .top topology file</desc>
            </field>
            <!-- for now, a hack: an optional input on whether to generate
                 velocities. -->
            <!--<field type="int" id="gen_vel" opt="true">
                <desc>here for backward compatibility</desc>
            </field>-->
            <field type="grompp-include-array" id="include" opt="true">
                <desc>array of files to include</desc>
            </field>
            <field type="mdp-array" id="settings" opt="true">
                <desc>array of settings</desc>
            </field>
            <field type="file" id="ndx" opt="true">
                <desc>An .ndx index file</desc>
            </field>
        </inputs>
        <outputs>
            <field type="file" id="tpr">
                <desc>the tpr file for mdrun</desc>
            </field>
            <field type="file" id="stdout">
                <desc>stdout generated during grompp run</desc>
            </field>
        </outputs>
        <controller function="cpc.lib.gromacs.grompp" 
                    import="cpc.lib.gromacs" />
    </function>

    <!-- gromacs mdrun controller function -->
    <function id="mdrun" type="python-extended">
        <desc>Runs an MD simulation.</desc>
        <inputs>
            <field type="file" id="tpr">
                <desc>The tpr file generated by grompp</desc>
            </field>
            <field type="int" id="priority" opt="true">
                <desc>An optional priority for commands issued</desc>
            </field>
            <field type="string" id="cmdline_options" opt="true">
                <desc>An optional string with command line options for mdrun 
                      to use</desc>
            </field>
        </inputs>
        <outputs>
            <field type="file" id="conf">
                <desc>Output configuration (.gro) file</desc>
            </field>
            <field type="file" id="stderr">
                <desc>mdrun's standard error output</desc>
            </field>
            <field type="file" id="stdout">
                <desc>mdrun's standard output output</desc>
            </field>
            <field type="file" id="xtc" optional="1">
                <desc>compressed (xtc) trajectory file</desc>
            </field>
            <field type="file" id="trr" optional="1">
                <desc>full-precision (trr) trajectory file</desc>
            </field>
            <field type="file" id="edr">
                <desc>energy+measurements output file</desc>
            </field>
        </outputs>
        <controller function="cpc.lib.gromacs.mdrun" 
                    import="cpc.lib.gromacs" 
                    persistent_dir="true" />
    </function>

    <function id="g_energy" type="python-extended">
        <desc>Extracts energy + other global averages from an .edr file.</desc>
        <inputs>
            <field type="file" id="edr">
                <desc>The edr file generated by mdrun</desc>
            </field>
            <field type="string" id="item">
                <desc>The item name to extract. Valid choices include: Potential, Kinetic, Total-Energy, Temperature, Pressure, Pres-XX - Pres-ZZ, Vir-XX - Vir-ZZ, Volume</desc>
            </field>
        </inputs>
        <outputs>
            <field type="file" id="xvg">
                <desc>Output plot</desc>
            </field>
            <field type="float" id="average">
                <desc>The extracted item's average</desc>
            </field>
            <field type="float" id="error">
                <desc>The extracted item's error estimate around the average.</desc>
            </field>
            <field type="float" id="drift">
                <desc>The extracted item's total drift.</desc>
            </field>
            <field type="float" id="rmsd">
                <desc>The extracted item's root mean square deviation.</desc>
            </field>
            <field type="string" id="unit">
                <desc>The extracted item's units in a string.</desc>
            </field>
        </outputs>
        <controller function="cpc.lib.gromacs.g_energy" 
                    import="cpc.lib.gromacs" 
                    persistent_dir="true" />
    </function>
</cpc>
