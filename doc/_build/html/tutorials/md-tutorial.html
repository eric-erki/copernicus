

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introductory Tutorial &mdash; Copernicus 2.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Copernicus 2.1 documentation" href="../index.html"/>
        <link rel="up" title="Tutorials" href="index.html"/>
        <link rel="next" title="MSM Tutorial" href="msm-tutorial.html"/>
        <link rel="prev" title="Tutorials" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> Copernicus</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#downloading-copernicus">Downloading Copernicus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#server-setup">Server Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#client-setup">Client Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#worker-setup">Worker Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../network/index.html">Copernicus overlay network</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../network/server.html">Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network/worker.html">Worker</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Introductory Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="msm-tutorial.html">MSM Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="fe-tutorial.html">Free Energy Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="swarms-tutorial.html">Swarms Tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">Developer Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../developers/submitting-pull-requests.html">Submitting Pull requetsts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/writing-docs.html">Writing Documentation</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Copernicus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Tutorials</a> &raquo;</li>
      
    <li>Introductory Tutorial</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/tutorials/md-tutorial.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="introductory-tutorial">
<span id="mdtutorial"></span><h1>Introductory Tutorial<a class="headerlink" href="#introductory-tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will get you introduced to the basics of copernicus. After
finishing this tutorial you will be able to:</p>
<ul class="simple">
<li>Setup a copernicus network ready to run projects and distribute tasks for you.</li>
<li>Create a project workflow for molecular simulations.</li>
<li>Learn how to monitor project progress, fetch results and alter input data while a project is running.</li>
</ul>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>The section <em class="xref std std-ref">getting-started</em> of the User guide covers the installation of
Copernicus.</p>
<p>Tutorial files can be found here</p>
</div>
<div class="section" id="creating-a-workflow-for-molecular-simulations">
<h2>Creating a workflow for molecular simulations<a class="headerlink" href="#creating-a-workflow-for-molecular-simulations" title="Permalink to this headline">¶</a></h2>
<p>In projects where one runs many variations of a simulation many small things add up and the process
can become tedious. Imagine having to manually copy over all files to various machines, run the
simulations and download them to another machine for postprocessing.
When work adds up the possibility for errors in simulations or machine errors also increases.</p>
<p>In this example we will build a molecular simulation workflow that lets us handle multiple simulations.
By providing a couple of input files we want this workflow to generate molecular simulation jobs.
Copernicus will then automatically distribute these jobs to available worker units and monitor them.
In cases things jobs go wrong they will be automatically regenerated and put back on the Copernicus
queue. In some cases things go wrong and requires user intervention. Copernicus will in these cases
halt that job and ask for a user to interact.
All of this allows the user to focus on the problem instead of having to focus on what things should run where.</p>
<p>Workflow components are called functions. Functions operate on inputs and generate outputs. Outputs of one function can be connected to the input of another functions.
Copernicus already has many ready made functions for Gromacs. We will utilize these to create our workflow.</p>
<p>Before we create a workflow we need to start a new project.</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc start md_simulations
Project md_simulations created
</pre></div>
</div>
<p>You can now see the newly created project in the projects list.</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc projects
Projects:
     md_simulations
</pre></div>
</div>
<p>The gromacs functions are available via the gromacs module
We import it with</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc info gromacs

\.\.\.\.\.\.

\.\.\.\.\.\.

grompps
     Prepares multiple simulations; can handle multiple input
     files.Each input is an array that can have N or 1 elements,
     where N is the number of desired outputs. If the number of
     inputs is Neach input will go to its own instance of grompp.
     If the number of inputs in an array is 1, this will be
     distributed along all the grompp instances. The output is an
     array of .tprs.
mdruns
     Runs a set of MD simulations. Inputs are spread in the same
     way as grompps

\.\.\.\.\.\.
</pre></div>
</div>
<p>Among the functions you will see two called grompps and mdruns. These two functions can handle multiple simulations.
lets start by creating one instance of grompps.</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc instance gromacs::grompps grompp
</pre></div>
</div>
<p>This roughly translates to “create a workflow block that will use the grompps function from gromacs and lets call it grompp”.
Now we’ll create an instance of the mdruns function:</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc instance gromacs::mdruns mdrun
</pre></div>
</div>
<p>If we list the currently instantiated workflow blocks:</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc ls
Network &#39;&#39;:
Network function instances:
    grompp (held)
    mdrun (held)
</pre></div>
</div>
<p>we see that the our grompp and mdrun blocks are there an there status is “held”, This means that they are currently inactivated and not running anything. When we have finished building the workflow we will activate them.
We have now created an instance to each function, however they are not connected yet.</p>
<div class="align-center figure">
<a class="reference internal image-reference" href="../_images/grompp_mdrun_functions.png"><img alt="Instantiated functions" src="../_images/grompp_mdrun_functions.png" style="width: 250px; height: 207px;" /></a>
<p class="caption">The current progress. We have now defined our first blocks but we still have not connected them</p>
</div>
<p>We will now connect the two block so it looks like this.</p>
<div class="align-center figure">
<a class="reference internal image-reference" href="../_images/grompp_mdrun_functions_connected.png"><img alt="Connected functions" src="../_images/grompp_mdrun_functions_connected.png" style="width: 521px; height: 92px;" /></a>
<p class="caption">The look of the workflow after we have connected our blocks.</p>
</div>
<p>The output of grompp is tpr files, and we’d like grompp to pass these on to mdrun once it’s produced.</p>
<p>First we call the command <tt class="docutils literal"><span class="pre">cpcc</span> <span class="pre">transact</span></tt>. This way we can send many commands at once and treat
them as if they are a single update. When we are finished sending commands, we’ll finish the
transaction block with the command <tt class="docutils literal"><span class="pre">cpcc</span> <span class="pre">commit</span></tt>.
Once the transaction has started, we connect the blocks.
We do this by connecting the grompp tpr output to the mdrun tpr input.</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc transact
&gt; cpcc connect grompp.out.tpr mdrun.in.tpr
Scheduled to connect grompp.out.tpr to mdrun.in.tpr at commit
</pre></div>
</div>
<p>here you will notice syntax like grompp.out.tpr, These are called workflow paths. The next section
we’ll cover them in more detail. We can now activate all the workflow blocks. This means that they
should start listening to incoming input.</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc activate
</pre></div>
</div>
<p>We finish the transaction by calling</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc commit
</pre></div>
</div>
<p>This tells Copernicus that it should start processing all the commands that we have called during
this transaction.</p>
<p>At this stage we have finished building our workflow, and it’s ready to take input.</p>
<p>We will now use our created workflow to start some simulations</p>
</div>
<div class="section" id="listing-workflow-functions">
<h2>Listing workflow functions<a class="headerlink" href="#listing-workflow-functions" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc ls
Network &#39;&#39;:
Network function instances:
    grompp (active)
    mdrun(active)
</pre></div>
</div>
<p>Earlier when we used this command the functions where in a held state. This time we see that they
are active meaning that they will react if we provide input. We can also take a deeper look at an
individual function to see what inputs and outputs it handles. This is done by calling <tt class="docutils literal"><span class="pre">cpcc</span> <span class="pre">ls</span></tt>
followed by the name of the function.</p>
<div class="highlight-none"><div class="highlight"><pre> &gt; cpcc ls grompp
Instance &#39;grompp&#39;:
Instance of: gromacs::grompps
State: active
Inputs:
    conf
    mdp
    top
    ndx
    settings
    include
Outputs:
    tpr
Subnet function instances:
</pre></div>
</div>
<p>Function inputs types can be inspected this way</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc ls grompp.in
Input/Output Value &#39;grompp:in&#39;:
Type: grompp:in
Sub-items:
    conf: conf_array
    mdp: mdp_file_array
    top: top_array
    ndx: ndx_array, optional
    settings: mdp_array_array, optional
    include: grompp_include_array_array, optional
</pre></div>
</div>
<p>This shows us that the conf, mdp and top inputs are array types, which means that we can provide
multiple conf files, leading to multiple simulations in this case. Later in the project we will use
this to actually start multiple simulations. We also see that the inputs ndx and settings have the
description “optional”, which means that the function can run without having set those inputs.
We can also look at the output types in a similar way:</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc ls grompp.out
</pre></div>
</div>
<p>To inspect or set the actual values, we can use the <tt class="docutils literal"><span class="pre">cpcc</span> <span class="pre">set</span></tt> and <tt class="docutils literal"><span class="pre">cpcc</span> <span class="pre">get</span></tt> commands.
We will use these soon to provide input files to our projects and later take a look at the results.</p>
</div>
<div class="section" id="providing-input-files-to-our-project">
<h2>Providing input files to our project.<a class="headerlink" href="#providing-input-files-to-our-project" title="Permalink to this headline">¶</a></h2>
<p>To get things to run, we need to provide 3 input files: a configuration file, a topology file which
describes the system that we want to simulate, and an mdp file which contain the simulation settings
. These files are standard Gromacs file types, and for this tutorial you can find them ready made in
the tutorials directory.</p>
<p>we will use the <tt class="docutils literal"><span class="pre">cpcc</span> <span class="pre">setf</span></tt> command to provide the input files for our grompp function.</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc setf grompp.in.conf[+] conf.gro
Committing scheduled changes:
- Set grompp:grompp:in.conf[0] to _inputs/0000/conf.gro
</pre></div>
</div>
<p>The section <tt class="docutils literal"><span class="pre">grompp:in.conf[+]</span></tt> specifies where a file should be sent to. in this case we want to
send it to the conf input. the last section <tt class="docutils literal"><span class="pre">[+]</span></tt> means “add this file”. Remember when we did
<tt class="docutils literal"><span class="pre">cpcc</span> <span class="pre">ls</span> <span class="pre">grompp:in</span></tt> and we saw that the conf input was an array? that is why we can add files by
using the plus. lets add the topology file and the mdp file.</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc setf grompp.in.top[+] topol.top
Committing scheduled changes:
- Set grompp:grompp:in.top[0] to _inputs/0001/topol.top

&gt; cpcc setf grompp.in.mdp[+] grompp.mdp
Committing scheduled changes:
- Set grompp:grompp:in.mdp[0] to _inputs/0002/grompp.mdp
</pre></div>
</div>
<p>Our grompp block has now gotten enough information to generate an output, and send it to the mdrun block, The mdrun block will then send a simulation job to the work queue.
By now the workflow should have gotten the input it needs to prepare a simulation.
If we take a look at the queue we should see that an item should have appeared.</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc q
Queue:
  0 mdrun:mdrun_0.1: gromacs/mdrun
</pre></div>
</div>
<p>This means server has generated a job and waiting for a worker to send it to.
If the worker is still running it should receive this job within maximum 30 seconds.
For the sake of this tutorial the simulation is very short and should be finished within a minute.
In reality a simulation could take days. The worker would in these cases send back intermediate
results to the server in one hour intervals.</p>
</div>
<div class="section" id="looking-at-the-results">
<h2>Looking at the results<a class="headerlink" href="#looking-at-the-results" title="Permalink to this headline">¶</a></h2>
<p>After finishing the last job, we should have some results to look at. The outputs can be found in
the outputs of our mdrun block. We can simply download them to our computer by running a workflow
query and direct its output to a file. for example downloading the trajectory file</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc getf mdrun.out.xtc[0] &gt; ~/trajectory.xtc
</pre></div>
</div>
<p>which would download the trajectory to our home directory.
Again we see the square bracket syntax, this time with a digit instead of a plus sign.
As we noted earlier some inputs and outputs are array types. In the case of the output this means
that we can have multiple outputs. We specify which output we want to look at by specifying an index
number.</p>
</div>
<div class="section" id="running-more-simulations">
<h2>Running more simulations.<a class="headerlink" href="#running-more-simulations" title="Permalink to this headline">¶</a></h2>
<p>Usually, we want to run more than one simulation to obtain more samples and trajectories – with each
simulation having very similar settings. To run more simulations in our case, we can use some of
the inputs we have already provided. We will simply provide a few new configurations. We can cheat,
and provide the simulation the same configuration as before:</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc setf grompp.in.conf[+] conf.gro
</pre></div>
</div>
<p>You can check the work queue to see the progress of this simulation.
When it’s done, try to call the command</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc get mdrun:out.xtc
mdrun:out.xtc: [
  mdrun/mdrun_0/_run_0000/traj.xtc,
  mdrun/mdrun_1/_run_0000/traj.xtc
]
</pre></div>
</div>
<p>which now gives two trajectory files. We can fetch the latest simulation trajectory with</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc getf mdrun:out.xtc[1] &gt; ~/trajectory_1.xtc
</pre></div>
</div>
</div>
<div class="section" id="pausing-a-project">
<h2>Pausing a project<a class="headerlink" href="#pausing-a-project" title="Permalink to this headline">¶</a></h2>
<p>Projects usually run until you decide its finished you can always pause them temporarily by calling.</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc deactivate
</pre></div>
</div>
<p>To start the project again you call</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc activate
</pre></div>
</div>
</div>
<div class="section" id="finishing-a-project">
<h2>Finishing a project<a class="headerlink" href="#finishing-a-project" title="Permalink to this headline">¶</a></h2>
<p>At one time you might want to finish a project and move it away from the server.
The command cpcc save will save your project and backup everything in a compressed file.</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc save md_simulations
Saved project to md_simulations.tar.gz
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">cpcc</span> <span class="pre">save</span></tt> will also deactivate your project however it will not delete the project from the server.
You will need to do that yourself.</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc rm md_simulations
</pre></div>
</div>
<p>To load a saved projects you call</p>
<div class="highlight-none"><div class="highlight"><pre>&gt; cpcc load md_simulations.tar.gz md_simulations
Project restored as md_simulations
</pre></div>
</div>
<p>The project is restored but held in a deactivated state. you can start it with <tt class="docutils literal"><span class="pre">cpcc</span> <span class="pre">activate</span></tt>.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="msm-tutorial.html" class="btn btn-neutral float-right" title="MSM Tutorial"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Tutorials"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Sander Pronk, Iman Pouya, Erik Lindahl and others.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>