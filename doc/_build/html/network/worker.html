

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Worker &mdash; Copernicus 2.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Copernicus 2.1 documentation" href="../index.html"/>
        <link rel="up" title="Copernicus overlay network" href="index.html"/>
        <link rel="next" title="Client" href="client.html"/>
        <link rel="prev" title="Server" href="server.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> Copernicus</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#downloading-copernicus">Downloading Copernicus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#server-setup">Server Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#client-setup">Client Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#worker-setup">Worker Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Copernicus overlay network</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="server.html">Server</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Worker</a></li>
<li class="toctree-l2"><a class="reference internal" href="client.html">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced-network-setups.html">Advanced Network setups</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/md-tutorial.html">Molecular Dynamics Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/msm-tutorial.html">MSM Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/swarms-tutorial.html">Swarms Tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">Developer Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../developers/submitting-pull-requests.html">Submitting Pull requetsts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers/writing-docs.html">Writing Documentation</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Copernicus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Copernicus overlay network</a> &raquo;</li>
      
    <li>Worker</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/network/worker.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="worker">
<span id="id1"></span><h1>Worker<a class="headerlink" href="#worker" title="Permalink to this headline">¶</a></h1>
<p>Workers are responsible for most of the computational work in copernicus.
They act as simple programs connecting to a server and asking for work.
Workers can have very different capabilites with regard to cpu capabilites,
and what programs they can execute.
When you start a worker it will establish a secure connection to your server and
announce the programs and their versions it can execute.
The server will then match the capabilities of the worker to the available jobs
in the queue. By default a worker will try to use all available cores on a
machine however this can be configured.</p>
<div class="section" id="worker-and-server-communication">
<h2>Worker and Server communication<a class="headerlink" href="#worker-and-server-communication" title="Permalink to this headline">¶</a></h2>
<p>You can connect as many workers as you want to a Server.
And the only thing you need to do this is a connection bundle.
Workers and Server communication is one sided.
It is always initiated by the Worker and the Server is only able to send responses back.</p>
</div>
<div class="section" id="automatic-partitioning">
<h2>Automatic partitioning<a class="headerlink" href="#automatic-partitioning" title="Permalink to this headline">¶</a></h2>
<p>Workers always try to fully utilize the maximum number of cores available to them.
Thus they able to partition themselves to run multiple jobs at
once. For example if you have a worker with 24 available cores it can run one 24
core job or one 12 core job and 12 single core jobs. As long as the worker has
free cores it will announce itself as available to the Server.
However, workers do not monitor the overall CPU usage of the computer they are
running on, but assume that the CPU is not used for other tasks.</p>
</div>
<div class="section" id="limiting-the-number-of-cores">
<h2>Limiting the number of cores<a class="headerlink" href="#limiting-the-number-of-cores" title="Permalink to this headline">¶</a></h2>
<p>By default a worker tries to use all of the cores available on a machine.
However you can limit this with the flag <tt class="docutils literal"><span class="pre">-n</span></tt></p>
<div class="highlight-none"><div class="highlight"><pre>cpc-worker smp -n 12
</pre></div>
</div>
<p>You can also define how the partitioning of each individual job should be
limited with the flag <tt class="docutils literal"><span class="pre">-s</span></tt>.
For example to limit your worker to use only 12 cores and only 2 cores
per job you can do:</p>
<div class="highlight-none"><div class="highlight"><pre>cpc-worker smp -n 12 -s 2
</pre></div>
</div>
</div>
<div class="section" id="running-jobs-from-a-specific-project">
<h2>Running jobs from a specific project<a class="headerlink" href="#running-jobs-from-a-specific-project" title="Permalink to this headline">¶</a></h2>
<p>A worker can be dedicated to run jobs from a specific project this is done with
the flag <tt class="docutils literal"><span class="pre">-p</span></tt></p>
<div class="highlight-none"><div class="highlight"><pre>cpc-worker -p my-project smp
</pre></div>
</div>
</div>
<div class="section" id="avoiding-idle-workers">
<h2>Avoiding idle workers<a class="headerlink" href="#avoiding-idle-workers" title="Permalink to this headline">¶</a></h2>
<p>If you want to avoid having idle workers you can instruct them to shutdown after
an amount of idle time. This is done with the flag <tt class="docutils literal"><span class="pre">-q</span></tt></p>
<div class="highlight-none"><div class="highlight"><pre>cpc-worker -q 10 smp
</pre></div>
</div>
</div>
<div class="section" id="specifying-work-directory">
<h2>Specifying work directory<a class="headerlink" href="#specifying-work-directory" title="Permalink to this headline">¶</a></h2>
<p>When a job is running Workers store their work information in work directory.
This work directory is by default created in the same location as where the worker
is started. If you want to specify another work directory you can do it with the flag
<tt class="docutils literal"><span class="pre">-wd</span></tt></p>
<div class="highlight-none"><div class="highlight"><pre>cpc-worker -wd my-worker-dir smp
</pre></div>
</div>
</div>
<div class="section" id="platform-types">
<span id="platformtypes"></span><h2>Platform types<a class="headerlink" href="#platform-types" title="Permalink to this headline">¶</a></h2>
<p>Workers can be started with different platform types.
The standard platform type is <tt class="docutils literal"><span class="pre">smp</span></tt>. This one should be used to run a worker on a
single node.
The platform type <tt class="docutils literal"><span class="pre">mpi</span></tt> should be used when one has binaries using OpenMPI.
Any binary that you usually start with mpirun from the command line should use
this platform type.</p>
</div>
<div class="section" id="executing-workers-in-a-cluster-environment">
<h2>Executing workers in a cluster environment<a class="headerlink" href="#executing-workers-in-a-cluster-environment" title="Permalink to this headline">¶</a></h2>
<p>Starting workers in a cluster environment is very straightforward.
You will only need to call the worker from your job submission script.
You only need to start one worker for all the resources that you allocate.</p>
<p>This is the general structure to use for starting a copernicus worker.</p>
<div class="highlight-none"><div class="highlight"><pre>## 1.ADD specific parameters for your queuing system ##

## 2. starting a copernicus worker ##
cpc-worker mpi -n NUMBER_OF_CORES
</pre></div>
</div>
<p>Here is a specific version for the slurm queing system</p>
<div class="highlight-none"><div class="highlight"><pre>#!/bin/bash
#SBATCH -N 12
#SBATCH --exclusive
#SBATCH --time=05:00:00
#SBATCH --job-name=cpc

#Assuming each node has 16 cores, 12*16=192
cpc-worker mpi -n 192
</pre></div>
</div>
</div>
<div class="section" id="best-practices-when-using-1000-cores">
<h2>Best practices when using 1000+ cores<a class="headerlink" href="#best-practices-when-using-1000-cores" title="Permalink to this headline">¶</a></h2>
<p>Copernicus is a very powerful tool and can start using thousands of cores at
an instant.  When starting large scale resources it is advisable to gradually
ramp up the resource usage and monitor the project to see if any critical errors
occur in the project or your cluster environment.
If everything looks fine start allocating more and more resources.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="client.html" class="btn btn-neutral float-right" title="Client"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="server.html" class="btn btn-neutral" title="Server"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Sander Pronk, Iman Pouya, Erik Lindahl and others.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>